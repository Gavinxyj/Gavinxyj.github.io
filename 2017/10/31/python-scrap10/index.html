<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="版权声明:本文为作者原创文章，可以随意转载，但必须在明确位置标明出处！！！
最近知乎上有一篇文章《月入五万的西二旗人教你如何活得像月薪五千》说的是北京西二旗程序员月入五万却过着月薪五千一样的生活，相比较其它行业，程序员的工资相对来说算是比较高的，程序员给人的形象永远都是眼镜、没刮过的胡须、乱糟糟的头">
    

    <!--Author-->
    
        <meta name="author" content="Gavin">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="python-scrap10"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Gavin Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>python-scrap10 - Gavin Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Gavin Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/Gavinxyj">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>python-scrap10</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2017-10-31
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <blockquote>
<h3 id="版权声明-本文为作者原创文章，可以随意转载，但必须在明确位置标明出处！！！"><a href="#版权声明-本文为作者原创文章，可以随意转载，但必须在明确位置标明出处！！！" class="headerlink" title="版权声明:本文为作者原创文章，可以随意转载，但必须在明确位置标明出处！！！"></a>版权声明:本文为作者原创文章，可以随意转载，但必须在明确位置标明出处！！！</h3></blockquote>
<p>最近知乎上有一篇文章《月入五万的西二旗人教你如何活得像月薪五千》说的是北京西二旗程序员月入五万却过着月薪五千一样的生活，相比较其它行业，程序员的工资相对来说算是比较高的，程序员给人的形象永远都是眼镜、没刮过的胡须、乱糟糟的头发、还有个必备的电脑包（毕竟这可是吃饭的家伙），就是这种形象的人拿着月薪五万却过着月薪五千的生活，不过这是有原因的，996的工作时间（朝九晚九+周六），公司发的工装和冲锋衣可以一年四季穿到头，全年都不带买衣服的，唯一的爱好可能就是打打游戏，买买电子产品了，显示器一定要大，而且不止一个。所以如果你是妹子，那么找个程序员也是不错的，安全、放心。当然本章的重点不是讲怎么月入五万，本章的重点是讲怎么将数据写入到Excel表格中，方便我们做简单的统计。</p>
<p>上一章讲到了将如何将数据写入到文本文件里，但文本文件操作比较简单，如果我们要对数据做一些统计之类的操作那么文本文件就提供不了这些支持了，所以本章我们将数据写到Excel表格里做一些简单的统计。</p>
<p>###openpyxl库<br>读写Excel需要用到第三方库，这里我们选择openpyxl库，这个库可以操作新版本的Excel，xlrt、xlwt两个库是用来读写老版本的Execl的，也就是扩展名是*.xls</p>
<h3 id="安装openpyxl库"><a href="#安装openpyxl库" class="headerlink" title="安装openpyxl库"></a>安装openpyxl库</h3><p>在ubuntu命令行终端输入以下命令就可以安装openpydl库了，如果没有报错则证明你安装好了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo pip install openpyxl</div></pre></td></tr></table></figure></p>
<h3 id="校验openpyxl是否安装"><a href="#校验openpyxl是否安装" class="headerlink" title="校验openpyxl是否安装"></a>校验openpyxl是否安装</h3><p>在终端执行python–》回车–》import openpyxl–》回车。如果没有抛出异常证明该库已经安装好了。</p>
<h3 id="workbook、worksheet"><a href="#workbook、worksheet" class="headerlink" title="workbook、worksheet"></a>workbook、worksheet</h3><p>要读写Excel我们首先要弄清楚两个概念，</p>
<ul>
<li><strong>workbook</strong>: 工作簿，它的意思是我们打开一个Excel文档后，整个Excel文档被称作为一个工作簿。</li>
<li><strong>worksheet</strong>: 工作表，如果我们新键一个Excel文件，然后打开它，我们可以看到底部有一个Sheet的选项，也就是我们的当前表格，也被称之为活动表格。</li>
</ul>
<p>所以我们操作Excel表格的时候一定是要先有workbook后才能去操作worksheet，这点概念大家要弄清楚。</p>
<h3 id="在内存中操作Excel"><a href="#在内存中操作Excel" class="headerlink" title="在内存中操作Excel"></a>在内存中操作Excel</h3><p>有了上面工作簿和工作表的概念，那么我们在内存中的操作步骤也要遵循上面的先有工作簿，再有工作表的规定。所以我们第一步是先创建一个工作簿，其次是获取一个活动的工作表，最后才是去操作工作表中的元素，代码如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</div><div class="line"><span class="comment">#创建一个工作簿</span></div><div class="line">wb = Workbook()</div><div class="line"><span class="comment">#活取一个活动的工作表</span></div><div class="line">ws = wb.active</div><div class="line"><span class="comment">#给A1单元赋值</span></div><div class="line">ws[<span class="string">'A1'</span>] = <span class="string">'test'</span></div><div class="line"><span class="comment">#保存Excel</span></div><div class="line">wb.save(<span class="string">'sample.xlsx'</span>)</div></pre></td></tr></table></figure></p>
<h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><p><img src="http://upload-images.jianshu.io/upload_images/3485329-266c8dc36c8b8f29.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="执行结果"><br>从结果可以看到A1单元确实被赋值为test了。Sheet及时我们的活动表格。<br>如果你想修改Sheet的名称，或者想创建其它Sheet，下面这么做就可以了。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</div><div class="line"><span class="comment">#创建一个工作簿</span></div><div class="line">wb = Workbook()</div><div class="line"><span class="comment">#活取一个活动的工作表</span></div><div class="line">ws = wb.active</div><div class="line"><span class="comment">#给A1单元赋值</span></div><div class="line">ws[<span class="string">'A1'</span>] = <span class="string">'test'</span></div><div class="line"></div><div class="line">ws.title = <span class="string">'test'</span></div><div class="line"></div><div class="line">ws1 = wb.create_sheet(<span class="string">"test1"</span>)</div><div class="line">ws2 = wb.create_sheet(<span class="string">"test2"</span>)</div><div class="line"></div><div class="line"><span class="comment">#保存Excel</span></div><div class="line">wb.save(<span class="string">'sample.xlsx'</span>)</div></pre></td></tr></table></figure></p>
<h3 id="执行结果-1"><a href="#执行结果-1" class="headerlink" title="执行结果"></a>执行结果</h3><p><img src="http://upload-images.jianshu.io/upload_images/3485329-1ec370b19e09f4ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="执行结果"><br>从结果中可以看到我们将Sheet该成了test，并且新创建了test1,test2表格页签。</p>
<h3 id="访问元素"><a href="#访问元素" class="headerlink" title="访问元素"></a>访问元素</h3><p>这里需要注意的是，当我们在内存中创建一个worksheet的时候，它是不包含cells的，也就是不包含创建了单元格，只有当我们第一次去访问它的时候它才回去创建单元格，就像上面的代码ws[‘A1’] = ‘test’，当给A1单元格赋值的时候才回去创建单元格A1，这样做的目的相信大家都已经看出来了，节约资源，提高效率。cells操作还可以通过行、列来操作，如ws.cell(row=4, column=2, value=10)，就是给第4行第二列赋值为10，各位可是执行运行试试，看看结果是不是这样的。</p>
<p>###多行多列范围访问</p>
<ul>
<li><strong>切片式范围访问：</strong> 切片是python里经常用到的操作，openpyxl库对范围访问也可以切片，语法如下<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</div><div class="line"><span class="comment">#创建一个工作簿</span></div><div class="line">wb = Workbook()</div><div class="line"><span class="comment">#活取一个活动的工作表</span></div><div class="line">ws = wb.active</div><div class="line">cell_range = ws[<span class="string">'A1'</span> : <span class="string">'C4'</span>]</div><div class="line">print(cell_range)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>访问A1到C4范围的所有cell，它的输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">((&lt;Cell &apos;Sheet&apos;.A1&gt;, &lt;Cell &apos;Sheet&apos;.B1&gt;, &lt;Cell &apos;Sheet&apos;.C1&gt;), </div><div class="line">(&lt;Cell &apos;Sheet&apos;.A2&gt;, &lt;Cell &apos;Sheet&apos;.B2&gt;, &lt;Cell &apos;Sheet&apos;.C2&gt;),</div><div class="line"> (&lt;Cell &apos;Sheet&apos;.A3&gt;, &lt;Cell &apos;Sheet&apos;.B3&gt;, &lt;Cell &apos;Sheet&apos;.C3&gt;), </div><div class="line">(&lt;Cell &apos;Sheet&apos;.A4&gt;, &lt;Cell &apos;Sheet&apos;.B4&gt;, &lt;Cell &apos;Sheet&apos;.C4&gt;))</div></pre></td></tr></table></figure></p>
<p>结果返回的是一个元组，元组里每一项又包含了一个元组，该元组表示一行，一共4行。</p>
<ul>
<li><strong>按列访问</strong>： 按列访问的语法如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">from openpyxl import Workbook</div><div class="line">#创建一个工作簿</div><div class="line">wb = Workbook()</div><div class="line">#活取一个活动的工作表</div><div class="line">ws = wb.active</div><div class="line">col_range = ws[&apos;C:D&apos;]</div><div class="line">print(col_range)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>访问第C列到第D列的cell，执行结果如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">((&lt;Cell &apos;Sheet&apos;.C1&gt;,), (&lt;Cell &apos;Sheet&apos;.D1&gt;,))</div></pre></td></tr></table></figure></p>
<p>从这里我们可以看出在内存中创建一个工作表时，只有访问cell的时候cell才回被创建，当我们的程序做出一下改变是，它的结果会是什么呢。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">from openpyxl import Workbook</div><div class="line">#创建一个工作簿</div><div class="line">wb = Workbook()</div><div class="line">#活取一个活动的工作表</div><div class="line">ws = wb.active</div><div class="line">ws[&apos;A4&apos;] = &apos;SFS&apos;</div><div class="line">col_range = ws[&apos;C:D&apos;]</div><div class="line">print(col_range)</div></pre></td></tr></table></figure></p>
<p>执行程序后的结果变成了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">((&lt;Cell &apos;Sheet&apos;.C1&gt;, &lt;Cell &apos;Sheet&apos;.C2&gt;, &lt;Cell &apos;Sheet&apos;.C3&gt;, &lt;Cell &apos;Sheet&apos;.C4&gt;), </div><div class="line">(&lt;Cell &apos;Sheet&apos;.D1&gt;, &lt;Cell &apos;Sheet&apos;.D2&gt;, &lt;Cell &apos;Sheet&apos;.D3&gt;, &lt;Cell &apos;Sheet&apos;.D4&gt;))</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>按行访问</strong>：按行访问跟按列访问是一样的，具体的执行结果是怎么杨的，大家可以自己去尝试一下，语法如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">row5= ws[5]</div><div class="line">row_range = ws[5:10]</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="迭代器访问行列区域"><a href="#迭代器访问行列区域" class="headerlink" title="迭代器访问行列区域"></a>迭代器访问行列区域</h3><p>除了切片方式，openpyxl也提供了迭代器的方式来访问行列，如下按行优先访问2 * 3列范围的元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">from openpyxl import Workbook</div><div class="line">#创建一个工作簿</div><div class="line">wb = Workbook()</div><div class="line">#活取一个活动的工作表</div><div class="line">ws = wb.active</div><div class="line">for row in ws.iter_rows(min_row=1, max_col=3, max_row=2):</div><div class="line">    for cell in row:</div><div class="line">        print(cell)</div></pre></td></tr></table></figure></p>
<p>执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;Cell &apos;Sheet&apos;.A1&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.B1&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.C1&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.A2&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.B2&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.C2&gt;</div></pre></td></tr></table></figure></p>
<p>按列优先访问如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">from openpyxl import Workbook</div><div class="line">#创建一个工作簿</div><div class="line">wb = Workbook()</div><div class="line">#活取一个活动的工作表</div><div class="line">ws = wb.active</div><div class="line">for row in ws.iter_cols(min_row=1, max_col=3, max_row=2):</div><div class="line">    for cell in row:</div><div class="line">        print(cell)</div></pre></td></tr></table></figure></p>
<p>执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;Cell &apos;Sheet&apos;.A1&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.A2&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.B1&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.B2&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.C1&gt;</div><div class="line">&lt;Cell &apos;Sheet&apos;.C2&gt;</div></pre></td></tr></table></figure></p>
<p>如果你需要迭代所有的行列那你可以像这样做：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">from openpyxl import Workbook</div><div class="line">#创建一个工作簿</div><div class="line">wb = Workbook()</div><div class="line">#活取一个活动的工作表</div><div class="line">ws = wb.active</div><div class="line"></div><div class="line">#按行优先迭代</div><div class="line">ws[&apos;C9&apos;] = &apos;test&apos;</div><div class="line">print(tuple(ws.rows))</div><div class="line"></div><div class="line">#按列优先迭代</div><div class="line">print(tuple(ws.columns))</div></pre></td></tr></table></figure></p>
<p>执行结果到底怎样，各位自行探索一下。</p>
<h3 id="加载一个已存在的Excel文档"><a href="#加载一个已存在的Excel文档" class="headerlink" title="加载一个已存在的Excel文档"></a>加载一个已存在的Excel文档</h3><p>加载一个已存在的Excel文档非常简单，加载后返回一个workbook对象，那么我们就可以像上面介绍的操作去处理加载后的文档了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">from openpyxl import load_workbook</div><div class="line">wb2 = load_workbook(&apos;sample.xlsx&apos;)</div><div class="line">print wb2.get_sheet_names()</div></pre></td></tr></table></figure></p>
<h3 id="图表"><a href="#图表" class="headerlink" title="图表"></a>图表</h3><p>图表有2D和3D图表，下面以一个2D的图表作为例子，这个例子是openpyxl手册上的例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">from openpyxl import Workbook</div><div class="line">from openpyxl.chart import (</div><div class="line">    AreaChart,</div><div class="line">    Reference,</div><div class="line">    Series,</div><div class="line">)</div><div class="line"></div><div class="line">wb = Workbook()</div><div class="line">ws = wb.active</div><div class="line"></div><div class="line">rows = [</div><div class="line">    [&apos;Number&apos;, &apos;Batch 1&apos;, &apos;Batch 2&apos;],</div><div class="line">    [2, 40, 30],</div><div class="line">    [3, 40, 25],</div><div class="line">    [4, 50, 30],</div><div class="line">    [5, 30, 10],</div><div class="line">    [6, 25, 5],</div><div class="line">    [7, 50, 10],</div><div class="line">]</div><div class="line"></div><div class="line">for row in rows:</div><div class="line">    ws.append(row)</div><div class="line"></div><div class="line">chart = AreaChart()</div><div class="line">chart.title = &quot;Area Chart&quot;</div><div class="line">chart.style = 13</div><div class="line">chart.x_axis.title = &apos;Test&apos;</div><div class="line">chart.y_axis.title = &apos;Percentage&apos;</div><div class="line"></div><div class="line">cats = Reference(ws, min_col=1, min_row=1, max_row=7)</div><div class="line">data = Reference(ws, min_col=2, min_row=1, max_col=3, max_row=7)</div><div class="line">chart.add_data(data, titles_from_data=True)</div><div class="line">chart.set_categories(cats)</div><div class="line"></div><div class="line">ws.add_chart(chart, &quot;A10&quot;)</div><div class="line"></div><div class="line">wb.save(&quot;area.xlsx&quot;)</div></pre></td></tr></table></figure></p>
<p>执行后的结果：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3485329-9c69d6ae9537dcec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图表结果"><br>openpyxl提供了非常丰富的图表支持，像条形图、柱状图、饼图、曲线图等等，有兴趣的同学可以到<a href="https://openpyxl.readthedocs.io/en/default/" target="_blank" rel="external">https://openpyxl.readthedocs.io/en/default/</a>查看。当然想合并单元格、公式、高亮、文本格式等等用法都可以到上面提供的网址查看。</p>
<h3 id="用图表来表示哪个用户获得的好笑数最高"><a href="#用图表来表示哪个用户获得的好笑数最高" class="headerlink" title="用图表来表示哪个用户获得的好笑数最高"></a>用图表来表示哪个用户获得的好笑数最高</h3><p>下面我们把爬到的数据写入到Excel表格中，并且用图表来先生哪个用户的好笑数最高，代码如下，源码放在<a href="https://github.com/Gavinxyj/Python/tree/master/python_study/Scrapy/modules" target="_blank" rel="external">https://github.com/Gavinxyj/Python/tree/master/python_study/Scrapy/modules</a>欢迎大家fork、Stars<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Scheduler.py</span></div><div class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</div><div class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> error</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">from</span> Excel <span class="keyword">import</span> ExcelOper</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, url, user_agent)</span>:</span></div><div class="line">        self.url = url</div><div class="line">        self.headers = &#123;<span class="string">'User-Agent'</span>: user_agent&#125;</div><div class="line">        self.excel_obj = ExcelOper()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_html</span><span class="params">(self, codec)</span>:</span></div><div class="line">        <span class="string">'''[read_html]</span></div><div class="line">        </div><div class="line">        [读取html页面内容]</div><div class="line">        </div><div class="line">        Arguments:</div><div class="line">            url &#123;[string]&#125; -- [url地址]</div><div class="line">            headers &#123;[dict]&#125; -- [用户代理，这里是一个字典类型]</div><div class="line">            codec &#123;[string]&#125; -- [编码方式]</div><div class="line">        </div><div class="line">        Returns:</div><div class="line">            [string] -- [页面内容]</div><div class="line">        '''</div><div class="line">        <span class="comment"># 构建一个请求对象</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            req = request.Request(self.url, headers=self.headers)</div><div class="line">            <span class="comment"># 打开一个请求</span></div><div class="line">            response = request.urlopen(req)</div><div class="line">            <span class="comment"># 读取服务器返回的页面数据内容</span></div><div class="line">            content = response.read().decode(codec)</div><div class="line"></div><div class="line">            <span class="keyword">return</span> content</div><div class="line"></div><div class="line">        <span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</div><div class="line">            print(e.reason)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">None</span>       </div><div class="line">        </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">match_element</span><span class="params">(self, content, pattern)</span>:</span></div><div class="line">        <span class="string">'''[match_element]</span></div><div class="line">        </div><div class="line">        [匹配元素]</div><div class="line">        </div><div class="line">        Arguments:</div><div class="line">            content &#123;[string]&#125; -- [文本内容]</div><div class="line">            pattern &#123;[object]&#125; -- [匹配模式]</div><div class="line"></div><div class="line">        Returns:</div><div class="line">            [list] -- [匹配到的元素]</div><div class="line">        '''</div><div class="line">        <span class="comment"># 匹配所有用户信息</span></div><div class="line">        </div><div class="line">        userinfos = re.findall(pattern, content)</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> userinfos</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_file</span><span class="params">(self, content)</span>:</span></div><div class="line">        <span class="keyword">with</span> open(<span class="string">'./qiubai.txt'</span>, <span class="string">'a+'</span>) <span class="keyword">as</span> fp:</div><div class="line">            fp.write(content + <span class="string">'\n'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(self)</span>:</span></div><div class="line">        content = self.read_html(<span class="string">'utf-8'</span>)</div><div class="line">        pattern = re.compile(<span class="string">r'&lt;div class="article block untagged mb15[\s\S]*?class="stats-vote".*?&lt;/div&gt;'</span>, re.S)</div><div class="line">        <span class="keyword">if</span> content:</div><div class="line">            userinfos = self.match_element(content, pattern)</div><div class="line">            infos = []</div><div class="line">            <span class="keyword">if</span> userinfos:</div><div class="line">                pattern = re.compile(<span class="string">r'&lt;a href="(.*?)".*?&lt;h2&gt;(.*?)&lt;/h2&gt;.*?&lt;div class="content"&gt;(.*?)&lt;/div&gt;.*?&lt;i class="number"&gt;(.*?)&lt;/i&gt;'</span>, re.S)</div><div class="line">                picture = re.compile(<span class="string">r'&lt;div class="thumb"&gt;.*?src="(.*?)"'</span>, re.S)</div><div class="line">                <span class="keyword">for</span> userinfo <span class="keyword">in</span> userinfos:</div><div class="line">                    item = self.match_element(userinfo, pattern)</div><div class="line">                    pictures = self.match_element(userinfo, picture)</div><div class="line">                    <span class="keyword">try</span>:</div><div class="line">                        <span class="keyword">if</span> item:</div><div class="line">                            userid, name, content, num = item[<span class="number">0</span>]</div><div class="line">                            <span class="comment"># 去掉换行符，&lt;span&gt;&lt;/span&gt;，&lt;br/&gt;符号</span></div><div class="line">                            userid = re.sub(<span class="string">r'\n|&lt;span&gt;|&lt;/span&gt;|&lt;br/&gt;'</span>, <span class="string">''</span>, userid)</div><div class="line">                            name = re.sub(<span class="string">r'\n|&lt;span&gt;|&lt;/span&gt;|&lt;br/&gt;'</span>, <span class="string">''</span>, name)</div><div class="line">                            content = re.sub(<span class="string">r'\n|&lt;span&gt;|&lt;/span&gt;|&lt;br/&gt;|\x01'</span>, <span class="string">''</span>, content)</div><div class="line">                            </div><div class="line">                            <span class="keyword">if</span> pictures:</div><div class="line">                                path = <span class="string">'./users/'</span></div><div class="line">                                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</div><div class="line">                                    os.makedirs(path)</div><div class="line"></div><div class="line">                                request.urlretrieve(<span class="string">'http:'</span> + pictures[<span class="number">0</span>], path + os.path.basename(pictures[<span class="number">0</span>]))</div><div class="line">                                infos.append((userid, name, int(num), content, pictures[<span class="number">0</span>]))</div><div class="line">                                <span class="comment">#print((userid, name, num, content, pictures[0]))</span></div><div class="line">                                <span class="comment">#self.write_file(userid + '\t' + name + '\t' + content + '\t' + num + '\t' + pictures[0])</span></div><div class="line"></div><div class="line">                            <span class="keyword">else</span>:</div><div class="line">                                <span class="comment">#print((userid, name, content, num))</span></div><div class="line">                                infos.append((userid, name, int(num), content))</div><div class="line">                                <span class="comment">#self.write_file(userid + '\t' + name + '\t' + content + '\t' + num)</span></div><div class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                        print(e)</div><div class="line">                self.excel_obj.write_excel(infos)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">  url = <span class="string">'https://www.qiushibaike.com'</span></div><div class="line">  user_agent = <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36'</span></div><div class="line">  handle = Scheduler(url, user_agent)</div><div class="line">  handle.get_content()</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Excel.py</span></div><div class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook</div><div class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> (</div><div class="line">    AreaChart,</div><div class="line">    Reference,</div><div class="line">    Series,</div><div class="line">)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExcelOper</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.wb = Workbook()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write_excel</span><span class="params">(self, infos)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            ws = self.wb.active</div><div class="line">            <span class="comment"># 增加表头</span></div><div class="line">            ws.append([<span class="string">'id'</span>, <span class="string">'username'</span>, <span class="string">'funny_num'</span>, <span class="string">'context'</span>, <span class="string">'url'</span>])</div><div class="line">            <span class="keyword">for</span> row_index,row_value <span class="keyword">in</span> enumerate(infos, <span class="number">2</span>):</div><div class="line">                </div><div class="line">                <span class="keyword">for</span> col_index, col_value <span class="keyword">in</span> enumerate(row_value, <span class="number">1</span>):</div><div class="line">                    ws.cell(row=row_index, column=col_index, value=col_value)</div><div class="line"></div><div class="line">            self.draw_chart(ws)</div><div class="line">            self.wb.save(<span class="string">'qiubai.xlsx'</span>)</div><div class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">            <span class="keyword">raise</span> e</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">draw_chart</span><span class="params">(self, ws)</span>:</span></div><div class="line">        chart = AreaChart()</div><div class="line">        chart.title = <span class="string">"Joker Chart"</span></div><div class="line">        chart.style = <span class="number">13</span></div><div class="line">        chart.x_axis.title = <span class="string">'User'</span></div><div class="line">        chart.y_axis.title = <span class="string">'Funny Num'</span></div><div class="line"></div><div class="line">        cats = Reference(ws, min_col=<span class="number">2</span>, min_row=<span class="number">1</span>, max_row=<span class="number">25</span>)</div><div class="line">        data = Reference(ws, min_col=<span class="number">3</span>, min_row=<span class="number">1</span>, max_col=<span class="number">3</span>, max_row=<span class="number">25</span>)</div><div class="line">        chart.add_data(data, titles_from_data=<span class="keyword">True</span>)</div><div class="line">        chart.set_categories(cats)</div><div class="line"></div><div class="line">        ws.add_chart(chart, <span class="string">"A30"</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_excel</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>整个程序增加了一个Excel.py文件，主要用来主要用来操作excel表格，里面使用到的方法在本章都已经讲过，更多的图表制作有兴趣的同学可以自己去研究研究，最后奉上执行结果。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3485329-0f6fb0215281476a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="执行结果"></p>
<p><strong>PS:</strong> 如果你是“表”姐，需要经常在网上收集内容，那么找个程序员男朋友吧，他会帮你弄得妥妥的，再也不用加班，不用熬夜了，哈哈哈…</p>
<hr>
<blockquote>
<p><strong>欢迎关注我的公众号:「爱做饭的老谢」，老谢一直在努力…</strong><br><img src="/img/hexobuild/weixin.jpg" alt=""></p>
</blockquote>
<p>上一篇：<a href="/2017/10/29/python-scrap9">聚沙成塔–爬虫系列（九）（落地生根）</a></p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                      
<section id="comment">  
  <!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2017/10/31/python-scrap10/" data-title="python-scrap10" data-url="http://gavinxyj.com/2017/10/31/python-scrap10/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"gavinxyj"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</section>  
  
                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    
                        <li>
                            <a href="https://github.com/Gavinxyj" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://github.com/Gavinxyj" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://gavinxyj.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="mailto:xie_youjiang@163.com" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>